/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/8.0.28
 * Generated at: 2020-02-01 11:47:55 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.tag.web;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class exportToExcel_tag
    extends javax.servlet.jsp.tagext.SimpleTagSupport
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = null;
  }

  private javax.servlet.jsp.JspContext jspContext;
  private java.io.Writer _jspx_sout;
  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public void setJspContext(javax.servlet.jsp.JspContext ctx) {
    super.setJspContext(ctx);
    java.util.ArrayList _jspx_nested = null;
    java.util.ArrayList _jspx_at_begin = null;
    java.util.ArrayList _jspx_at_end = null;
    this.jspContext = new org.apache.jasper.runtime.JspContextWrapper(this, ctx, _jspx_nested, _jspx_at_begin, _jspx_at_end, null);
  }

  public javax.servlet.jsp.JspContext getJspContext() {
    return this.jspContext;
  }
  private java.lang.String type;
  private java.lang.String itemName;

  public java.lang.String getType() {
    return this.type;
  }

  public void setType(java.lang.String type) {
    this.type = type;
    jspContext.setAttribute("type", type);
  }

  public java.lang.String getItemName() {
    return this.itemName;
  }

  public void setItemName(java.lang.String itemName) {
    this.itemName = itemName;
    jspContext.setAttribute("itemName", itemName);
  }

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    return _jsp_instancemanager;
  }

  private void _jspInit(javax.servlet.ServletConfig config) {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(config.getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(config);
  }

  public void _jspDestroy() {
  }

  public void doTag() throws javax.servlet.jsp.JspException, java.io.IOException {
    javax.servlet.jsp.PageContext _jspx_page_context = (javax.servlet.jsp.PageContext)jspContext;
    javax.servlet.http.HttpServletRequest request = (javax.servlet.http.HttpServletRequest) _jspx_page_context.getRequest();
    javax.servlet.http.HttpServletResponse response = (javax.servlet.http.HttpServletResponse) _jspx_page_context.getResponse();
    javax.servlet.http.HttpSession session = _jspx_page_context.getSession();
    javax.servlet.ServletContext application = _jspx_page_context.getServletContext();
    javax.servlet.ServletConfig config = _jspx_page_context.getServletConfig();
    javax.servlet.jsp.JspWriter out = jspContext.getOut();
    _jspInit(config);
    jspContext.getELContext().putContext(javax.servlet.jsp.JspContext.class,jspContext);
    if( getType() != null ) 
      _jspx_page_context.setAttribute("type", getType());
    if( getItemName() != null ) 
      _jspx_page_context.setAttribute("itemName", getItemName());

    try {
      out.write("<meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel; charset=UTF-8\">\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
if(type.equalsIgnoreCase("simple_grid")){ 
      out.write("\n");
      out.write("\t<input type=\"button\" id=\"exportToWxcelBtn\" style=\"display: none;\"\n");
      out.write("\t       onclick=\"tableToExcel_simpleGrid('testTable', 'W3C Example Table')\"\n");
      out.write("\t       value=\"Export to Excel\">\n");
}else if(type.equalsIgnoreCase("search_grid")){ 
      out.write("\n");
      out.write("\t<input type=\"button\" id=\"exportToWxcelBtn\" style=\"display: none;\"\n");
      out.write("\t       onclick=\"tableToExcel('testTable', 'W3C Example Table')\"\n");
      out.write("\t       value=\"Export to Excel\">\n");
}else if(type.equalsIgnoreCase("item_grid")){ 
      out.write("\n");
      out.write("\t<input type=\"button\" id=\"exportToWxcelBtn\" style=\"display: none;\"\n");
      out.write("\t       onclick=\"tableToExcel_itemGrid_");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${itemName}", java.lang.String.class, (javax.servlet.jsp.PageContext)this.getJspContext(), null));
      out.write("('testTable', 'W3C Example Table')\"\n");
      out.write("\t       value=\"Export to Excel\">\n");
} 
      out.write("\n");
      out.write("\n");
      out.write("<table id=\"testTable\" summary=\"Code page support in different versions of MS Windows.\" rules=\"groups\" frame=\"hsides\" border=\"2\"></table>\n");
      out.write("\n");
      out.write("<a id=\"dlink\"  style=\"display:none;\"></a>\n");
      out.write("<script type=\"text/javascript\">\n");
      out.write("        var fileName='");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${pageTitle}", java.lang.String.class, (javax.servlet.jsp.PageContext)this.getJspContext(), null));
      out.write("';\n");
      out.write("    \tvar tableToExcel = (function() {\n");
      out.write("        return function(table, name) {\n");
      out.write("            if (!table.nodeType)\n");
      out.write("                table = document.getElementById(table);\n");
      out.write("            var searchJsonString = \"{}\";\n");
      out.write("            if(typeof(getSearchObject)==\"function\"){\n");
      out.write("                searchJsonString = JSON.stringify(getSearchObject());\n");
      out.write("                searchJsonString = searchJsonString.replace(/\\//g, ':@:');\n");
      out.write("            }\n");
      out.write("            $.ajax({\n");
      out.write("                url: \"search/exportToExcel/\"+searchJsonString,\n");
      out.write("                type:\"GET\",\n");
      out.write("                dataType:\"json\",\n");
      out.write("                contentType:\"application/json; charset=utf-8\",\n");
      out.write("                success: function (data) {\n");
      out.write("                    /*var uri = 'data:application/vnd.ms-excel;base64,'\n");
      out.write("                            , template = '<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\">' +\n");
      out.write("                                    '<meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel; charset=UTF-8\"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayRightToLeft/><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body dir=\"rtl\"><table>'+data.exportMessage+'</table></body></html>'\n");
      out.write("                            , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }\n");
      out.write("                            , format = function(s, c) { return s.replace(/{(\\w+)}/g, function(m, p) { return c[p]; }) }\n");
      out.write("                    var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}\n");
      out.write("//                    window.location.href = uri + base64(format(template, ctx));\n");
      out.write("                    document.getElementById(\"dlink\").href = uri + base64(format(template, ctx));\n");
      out.write("                    document.getElementById(\"dlink\").download = fileName+'-'+data.fileName;\n");
      out.write("                    document.getElementById(\"dlink\").click();*/\n");
      out.write("                    var tab_text = '<html xmlns:x=\"urn:schemas-microsoft-com:office:excel\"><meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel; charset=UTF-8\">';\n");
      out.write("                    tab_text = tab_text + '<head><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>';\n");
      out.write("                    tab_text = tab_text + '<x:Name>Test Sheet</x:Name>';\n");
      out.write("                    tab_text = tab_text + '<x:WorksheetOptions><x:DisplayRightToLeft/><x:DisplayGridlines/><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';\n");
      out.write("                    tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body dir=\"rtl\">';\n");
      out.write("                    tab_text = tab_text + \"<table border='1px'>\";\n");
      out.write("\n");
      out.write("                    tab_text = tab_text + data.exportMessage;\n");
      out.write("                    tab_text = tab_text + '</table></body></html>';\n");
      out.write("                    var fileN =fileName+'-'+data.fileName;\n");
      out.write("\n");
      out.write("                    //Save the file\n");
      out.write("                    var blob = new Blob([tab_text], { type: \"application/vnd.ms-excel;charset=utf-8\" })\n");
      out.write("                    window.saveAs(blob, fileN);\n");
      out.write("                },error:function(result){\n");
      out.write("                    if(result.status==401){\n");
      out.write("                        top.location.href=top.location.href;\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        };\n");
      out.write("    })();\n");
      out.write("\n");
      out.write("    \tvar tableToExcel_simpleGrid = (function() {\n");
      out.write("        return function(table, name) {\n");
      out.write("            if (!table.nodeType)\n");
      out.write("                table = document.getElementById(table);\n");
      out.write("            $.ajax({\n");
      out.write("                url: getBaseUrl() + \"/grid-read/exportToExcel\",\n");
      out.write("                type:\"GET\",\n");
      out.write("                dataType:\"json\",\n");
      out.write("                contentType:\"application/json; charset=utf-8\",\n");
      out.write("                success: function (data) {\n");
      out.write("                    /*var uri = 'data:application/vnd.ms-excel;base64,'\n");
      out.write("                            , template = '<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\">' +\n");
      out.write("                                    '<meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel; charset=UTF-8\"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook>' +\n");
      out.write("\t\t\t\t\t\t'<x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayRightToLeft/><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body dir=\"rtl\"><table>'+data.exportMessage+'</table></body></html>'\n");
      out.write("                            , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }\n");
      out.write("                            , format = function(s, c) { return s.replace(/{(\\w+)}/g, function(m, p) { return c[p]; }) }\n");
      out.write("                    var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}\n");
      out.write("                    document.getElementById(\"dlink\").href = uri + base64(format(template, ctx));\n");
      out.write("                    document.getElementById(\"dlink\").download = fileName+'-'+data.fileName;\n");
      out.write("                    document.getElementById(\"dlink\").click();*/\n");
      out.write("                    var tab_text = '<html xmlns:x=\"urn:schemas-microsoft-com:office:excel\"><meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel; charset=UTF-8\">';\n");
      out.write("                    tab_text = tab_text + '<head><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>';\n");
      out.write("                    tab_text = tab_text + '<x:Name>Test Sheet</x:Name>';\n");
      out.write("                    tab_text = tab_text + '<x:WorksheetOptions><x:DisplayRightToLeft/><x:DisplayGridlines/><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';\n");
      out.write("                    tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body dir=\"rtl\">';\n");
      out.write("                    tab_text = tab_text + \"<table border='1px'>\";\n");
      out.write("\n");
      out.write("                    tab_text = tab_text + data.exportMessage;\n");
      out.write("                    tab_text = tab_text + '</table></body></html>';\n");
      out.write("                    var fileN =fileName+'-'+data.fileName;\n");
      out.write("\n");
      out.write("                    //Save the file\n");
      out.write("                    var blob = new Blob([tab_text], { type: \"application/vnd.ms-excel;charset=utf-8\" })\n");
      out.write("                    window.saveAs(blob, fileN);\n");
      out.write("                },error:function(result){\n");
      out.write("                    if(result.status==401){\n");
      out.write("                        top.location.href=top.location.href;\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        };\n");
      out.write("    })();\n");
      out.write("    \n");
      out.write("    \tvar tableToExcel_itemGrid_");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${itemName}", java.lang.String.class, (javax.servlet.jsp.PageContext)this.getJspContext(), null));
      out.write(" = (function() {\n");
      out.write("        return function(table, name) {\n");
      out.write("            if (!table.nodeType)\n");
      out.write("                table = document.getElementById(table);\n");
      out.write("            var loadedId_ = $(\"#id\").val();\n");
      out.write("            var itemName_ = '");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${itemName}", java.lang.String.class, (javax.servlet.jsp.PageContext)this.getJspContext(), null));
      out.write("';\n");
      out.write("            $.ajax({\n");
      out.write("                url: getBaseUrl() + \"item-grid-read-exportToExcel/\"+itemName_+\"/\"+loadedId_,\n");
      out.write("                type:\"GET\",\n");
      out.write("                dataType:\"json\",\n");
      out.write("                contentType:\"application/json; charset=utf-8\",\n");
      out.write("                success: function (data) {\n");
      out.write("                    var uri = 'data:application/vnd.ms-excel;base64,'\n");
      out.write("                            , template = '<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\">' +\n");
      out.write("                                    '<meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel; charset=UTF-8\"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayRightToLeft/><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body dir=\"rtl\"><table>'+data.exportMessage+'</table></body></html>'\n");
      out.write("                            , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }\n");
      out.write("                            , format = function(s, c) { return s.replace(/{(\\w+)}/g, function(m, p) { return c[p]; }) }\n");
      out.write("                    var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}\n");
      out.write("                    document.getElementById(\"dlink\").href = uri + base64(format(template, ctx));\n");
      out.write("\t\t\t\t\tvar requestUrl = getBaseUrl() + \"item-exportToExcel-getItemName/\"+itemName_;\n");
      out.write("\t\t\t\t\tvar itemFileName = \"\";\n");
      out.write("\t\t\t\t\tvar dataFileName = data.fileName;\n");
      out.write("\t\t\t\t\t$.getJSON(requestUrl, function (data) {\n");
      out.write("\t\t\t\t\t\titemFileName = data.itemFileName;\n");
      out.write("\t\t\t\t\t\tdocument.getElementById(\"dlink\").download = itemFileName+'-'+dataFileName;\n");
      out.write("\t                    document.getElementById(\"dlink\").click();\n");
      out.write("                    });\n");
      out.write("                },error:function(result){\n");
      out.write("                    if(result.status==401){\n");
      out.write("                        top.location.href=top.location.href;\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        };\n");
      out.write("    })();\n");
      out.write("\n");
      out.write("\n");
      out.write("         var saveAs = saveAs || (function(view) {\n");
      out.write("                \"use strict\";\n");
      out.write("                // IE <10 is explicitly unsupported\n");
      out.write("                if (typeof view === \"undefined\" || typeof navigator !== \"undefined\" && /MSIE [1-9]\\./.test(navigator.userAgent)) {\n");
      out.write("                    return;\n");
      out.write("                }\n");
      out.write("                var\n");
      out.write("                    doc = view.document\n");
      out.write("                    // only get URL when necessary in case Blob.js hasn't overridden it yet\n");
      out.write("                    , get_URL = function() {\n");
      out.write("                        return view.URL || view.webkitURL || view;\n");
      out.write("                    }\n");
      out.write("                    , save_link = doc.createElementNS(\"http://www.w3.org/1999/xhtml\", \"a\")\n");
      out.write("                    , can_use_save_link = \"download\" in save_link\n");
      out.write("                    , click = function(node) {\n");
      out.write("                        var event = new MouseEvent(\"click\");\n");
      out.write("                        node.dispatchEvent(event);\n");
      out.write("                    }\n");
      out.write("                    , is_safari = /constructor/i.test(view.HTMLElement) || view.safari\n");
      out.write("                    , is_chrome_ios =/CriOS\\/[\\d]+/.test(navigator.userAgent)\n");
      out.write("                    , setImmediate = view.setImmediate || view.setTimeout\n");
      out.write("                    , throw_outside = function(ex) {\n");
      out.write("                        setImmediate(function() {\n");
      out.write("                            throw ex;\n");
      out.write("                        }, 0);\n");
      out.write("                    }\n");
      out.write("                    , force_saveable_type = \"application/octet-stream\"\n");
      out.write("                    // the Blob API is fundamentally broken as there is no \"downloadfinished\" event to subscribe to\n");
      out.write("                    , arbitrary_revoke_timeout = 1000 * 40 // in ms\n");
      out.write("                    , revoke = function(file) {\n");
      out.write("                        var revoker = function() {\n");
      out.write("                            if (typeof file === \"string\") { // file is an object URL\n");
      out.write("                                get_URL().revokeObjectURL(file);\n");
      out.write("                            } else { // file is a File\n");
      out.write("                                file.remove();\n");
      out.write("                            }\n");
      out.write("                        };\n");
      out.write("                        setTimeout(revoker, arbitrary_revoke_timeout);\n");
      out.write("                    }\n");
      out.write("                    , dispatch = function(filesaver, event_types, event) {\n");
      out.write("                        event_types = [].concat(event_types);\n");
      out.write("                        var i = event_types.length;\n");
      out.write("                        while (i--) {\n");
      out.write("                            var listener = filesaver[\"on\" + event_types[i]];\n");
      out.write("                            if (typeof listener === \"function\") {\n");
      out.write("                                try {\n");
      out.write("                                    listener.call(filesaver, event || filesaver);\n");
      out.write("                                } catch (ex) {\n");
      out.write("                                    throw_outside(ex);\n");
      out.write("                                }\n");
      out.write("                            }\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("                    , auto_bom = function(blob) {\n");
      out.write("                        // prepend BOM for UTF-8 XML and text/* types (including HTML)\n");
      out.write("                        // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n");
      out.write("                        if (/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n");
      out.write("                            return new Blob([String.fromCharCode(0xFEFF), blob], {type: blob.type});\n");
      out.write("                        }\n");
      out.write("                        return blob;\n");
      out.write("                    }\n");
      out.write("                    , FileSaver = function(blob, name, no_auto_bom) {\n");
      out.write("                        if (!no_auto_bom) {\n");
      out.write("                            blob = auto_bom(blob);\n");
      out.write("                        }\n");
      out.write("                        // First try a.download, then web filesystem, then object URLs\n");
      out.write("                        var\n");
      out.write("                            filesaver = this\n");
      out.write("                            , type = blob.type\n");
      out.write("                            , force = type === force_saveable_type\n");
      out.write("                            , object_url\n");
      out.write("                            , dispatch_all = function() {\n");
      out.write("                                dispatch(filesaver, \"writestart progress write writeend\".split(\" \"));\n");
      out.write("                            }\n");
      out.write("                            // on any filesys errors revert to saving with object URLs\n");
      out.write("                            , fs_error = function() {\n");
      out.write("                                if ((is_chrome_ios || (force && is_safari)) && view.FileReader) {\n");
      out.write("                                    // Safari doesn't allow downloading of blob urls\n");
      out.write("                                    var reader = new FileReader();\n");
      out.write("                                    reader.onloadend = function() {\n");
      out.write("                                        var url = is_chrome_ios ? reader.result : reader.result.replace(/^data:[^;]*;/, 'data:attachment/file;');\n");
      out.write("                                        var popup = view.open(url, '_blank');\n");
      out.write("                                        if(!popup) view.location.href = url;\n");
      out.write("                                        url=undefined; // release reference before dispatching\n");
      out.write("                                        filesaver.readyState = filesaver.DONE;\n");
      out.write("                                        dispatch_all();\n");
      out.write("                                    };\n");
      out.write("                                    reader.readAsDataURL(blob);\n");
      out.write("                                    filesaver.readyState = filesaver.INIT;\n");
      out.write("                                    return;\n");
      out.write("                                }\n");
      out.write("                                // don't create more object URLs than needed\n");
      out.write("                                if (!object_url) {\n");
      out.write("                                    object_url = get_URL().createObjectURL(blob);\n");
      out.write("                                }\n");
      out.write("                                if (force) {\n");
      out.write("                                    view.location.href = object_url;\n");
      out.write("                                } else {\n");
      out.write("                                    var opened = view.open(object_url, \"_blank\");\n");
      out.write("                                    if (!opened) {\n");
      out.write("                                        // Apple does not allow window.open, see https://developer.apple.com/library/safari/documentation/Tools/Conceptual/SafariExtensionGuide/WorkingwithWindowsandTabs/WorkingwithWindowsandTabs.html\n");
      out.write("                                        view.location.href = object_url;\n");
      out.write("                                    }\n");
      out.write("                                }\n");
      out.write("                                filesaver.readyState = filesaver.DONE;\n");
      out.write("                                dispatch_all();\n");
      out.write("                                revoke(object_url);\n");
      out.write("                            }\n");
      out.write("                        ;\n");
      out.write("                        filesaver.readyState = filesaver.INIT;\n");
      out.write("\n");
      out.write("                        if (can_use_save_link) {\n");
      out.write("                            object_url = get_URL().createObjectURL(blob);\n");
      out.write("                            setImmediate(function() {\n");
      out.write("                                save_link.href = object_url;\n");
      out.write("                                save_link.download = name;\n");
      out.write("                                click(save_link);\n");
      out.write("                                dispatch_all();\n");
      out.write("                                revoke(object_url);\n");
      out.write("                                filesaver.readyState = filesaver.DONE;\n");
      out.write("                            }, 0);\n");
      out.write("                            return;\n");
      out.write("                        }\n");
      out.write("\n");
      out.write("                        fs_error();\n");
      out.write("                    }\n");
      out.write("                    , FS_proto = FileSaver.prototype\n");
      out.write("                    , saveAs = function(blob, name, no_auto_bom) {\n");
      out.write("                        return new FileSaver(blob, name || blob.name || \"download\", no_auto_bom);\n");
      out.write("                    }\n");
      out.write("                ;\n");
      out.write("\n");
      out.write("                // IE 10+ (native saveAs)\n");
      out.write("                if (typeof navigator !== \"undefined\" && navigator.msSaveOrOpenBlob) {\n");
      out.write("                    return function(blob, name, no_auto_bom) {\n");
      out.write("                        name = name || blob.name || \"download\";\n");
      out.write("\n");
      out.write("                        if (!no_auto_bom) {\n");
      out.write("                            blob = auto_bom(blob);\n");
      out.write("                        }\n");
      out.write("                        return navigator.msSaveOrOpenBlob(blob, name);\n");
      out.write("                    };\n");
      out.write("                }\n");
      out.write("\n");
      out.write("                // todo: detect chrome extensions & packaged apps\n");
      out.write("                //save_link.target = \"_blank\";\n");
      out.write("\n");
      out.write("                FS_proto.abort = function(){};\n");
      out.write("                FS_proto.readyState = FS_proto.INIT = 0;\n");
      out.write("                FS_proto.WRITING = 1;\n");
      out.write("                FS_proto.DONE = 2;\n");
      out.write("\n");
      out.write("                FS_proto.error =\n");
      out.write("                    FS_proto.onwritestart =\n");
      out.write("                        FS_proto.onprogress =\n");
      out.write("                            FS_proto.onwrite =\n");
      out.write("                                FS_proto.onabort =\n");
      out.write("                                    FS_proto.onerror =\n");
      out.write("                                        FS_proto.onwriteend =\n");
      out.write("                                            null;\n");
      out.write("\n");
      out.write("                return saveAs;\n");
      out.write("            }(\n");
      out.write("                typeof self !== \"undefined\" && self\n");
      out.write("                || typeof window !== \"undefined\" && window\n");
      out.write("                || this\n");
      out.write("            ));\n");
      out.write("    \n");
      out.write("</script>");
    } catch( java.lang.Throwable t ) {
      if( t instanceof javax.servlet.jsp.SkipPageException )
          throw (javax.servlet.jsp.SkipPageException) t;
      if( t instanceof java.io.IOException )
          throw (java.io.IOException) t;
      if( t instanceof java.lang.IllegalStateException )
          throw (java.lang.IllegalStateException) t;
      if( t instanceof javax.servlet.jsp.JspException )
          throw (javax.servlet.jsp.JspException) t;
      throw new javax.servlet.jsp.JspException(t);
    } finally {
      jspContext.getELContext().putContext(javax.servlet.jsp.JspContext.class,super.getJspContext());
      ((org.apache.jasper.runtime.JspContextWrapper) jspContext).syncEndTagFile();
    }
  }
}
